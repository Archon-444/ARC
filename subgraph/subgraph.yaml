specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # NFTMarketplace contract
  - kind: ethereum
    name: NFTMarketplace
    network: arc-testnet # Update for mainnet deployment
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed address
      abi: NFTMarketplace
      startBlock: 0 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Listing
        - Auction
        - Sale
        - NFT
        - User
        - Collection
        - Bid
        - MarketplaceStats
        - DailyStats
      abis:
        - name: NFTMarketplace
          file: ../contracts/artifacts/contracts/NFTMarketplace.sol/NFTMarketplace.json
        - name: ERC721
          file: ./abis/ERC721.json
      eventHandlers:
        # Listing events
        - event: ListingCreated(indexed address,indexed address,indexed uint256,uint256)
          handler: handleListingCreated
        - event: ListingUpdated(indexed address,indexed address,indexed uint256,uint256)
          handler: handleListingUpdated
        - event: ListingCancelled(indexed address,indexed address,indexed uint256)
          handler: handleListingCancelled
        - event: Purchased(indexed address,indexed address,indexed uint256,uint256)
          handler: handlePurchased
        # Auction events
        - event: AuctionCreated(indexed address,indexed address,indexed uint256,uint256,uint64,uint64)
          handler: handleAuctionCreated
        - event: BidPlaced(indexed address,indexed address,indexed uint256,uint256)
          handler: handleBidPlaced
        - event: AuctionSettled(indexed address,indexed address,indexed uint256,uint256)
          handler: handleAuctionSettled
        # Admin events
        - event: ProtocolFeeUpdated(uint16,uint16)
          handler: handleProtocolFeeUpdated
        - event: CollectionAllowed(indexed address,bool)
          handler: handleCollectionAllowed
      file: ./src/nft-marketplace.ts

  # FeeVault contract
  - kind: ethereum
    name: FeeVault
    network: arc-testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed address
      abi: FeeVault
      startBlock: 0 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - FeeDistribution
        - FeeSplit
      abis:
        - name: FeeVault
          file: ../contracts/artifacts/contracts/FeeVault.sol/FeeVault.json
      eventHandlers:
        - event: Distributed(indexed address,indexed uint256,uint256)
          handler: handleDistributed
        - event: GlobalSplitsUpdated((address,uint16)[])
          handler: handleGlobalSplitsUpdated
        - event: CollectionSplitsUpdated(indexed address)
          handler: handleCollectionSplitsUpdated
      file: ./src/fee-vault.ts

  # ProfileRegistry contract
  - kind: ethereum
    name: ProfileRegistry
    network: arc-testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed address
      abi: ProfileRegistry
      startBlock: 0 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Profile
        - User
      abis:
        - name: ProfileRegistry
          file: ../contracts/artifacts/contracts/ProfileRegistry.sol/ProfileRegistry.json
      eventHandlers:
        - event: ProfileUpdated(indexed address,string)
          handler: handleProfileUpdated
      file: ./src/profile-registry.ts
